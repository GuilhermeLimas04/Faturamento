<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Site de Faturamento (Estático)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#06b6d4;--accent-2:#7c3aed}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:linear-gradient(180deg,#071028 0%, #071826 50%); color:#e6eef6; min-height:100vh}
    header{padding:18px 20px; display:flex; gap:12px; align-items:center; border-bottom:1px solid rgba(255,255,255,.03)}
    header h1{font-size:18px;margin:0}
    .container{max-width:1100px;margin:28px auto;padding:18px}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,.6)}
    .muted{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#022;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:inherit}

    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px 8px;text-align:left;font-size:14px;border-bottom:1px dashed rgba(255,255,255,.03)}
    th{font-size:12px;color:var(--muted);font-weight:600}

    .right{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    form{display:flex;flex-direction:column;gap:10px}
    input,select,textarea{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:transparent;color:inherit}
    label{font-size:13px;color:var(--muted)}

    .invoice-preview{background:linear-gradient(180deg,#071028 0%, #08142a 100%);padding:18px;border-radius:10px}
    .invoice-row{display:flex;justify-content:space-between;gap:12px}

    .no-data{padding:28px;text-align:center;color:var(--muted)}

    /* print styles */
    @media print{
      header, .actions, .container{display:none}
      body{background:#fff;color:#000}
      .invoice-print{display:block}
    }

    .logo{display:inline-flex;align-items:center;gap:8px}
    .logo svg{width:36px;height:36px}
    .small{font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="2" y="3" width="20" height="14" rx="2" stroke="currentColor" stroke-width="1.2" opacity="0.9"></rect><path d="M7 21h10" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
      <div>
        <h1>Faturamento Estático</h1>
        <div class="muted small">Gerencie faturas no browser — sem servidor</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">Faturas</h2>
            <div class="muted">Lista de faturas salvas no navegador (localStorage)</div>
          </div>
          <div class="actions">
            <button id="btnNew">+ Nova Fatura</button>
            <button id="btnExport" class="ghost">Exportar CSV</button>
            <button id="btnClear" class="ghost">Limpar tudo</button>
          </div>
        </div>

        <div id="listWrapper" style="margin-top:14px">
          <table id="invoicesTable">
            <thead>
              <tr><th>#</th><th>Cliente</th><th>Data</th><th>Valor</th><th>Status</th><th></th></tr>
            </thead>
            <tbody id="invoicesBody">
            </tbody>
          </table>
          <div id="noData" class="no-data">Nenhuma fatura ainda. Clique em "Nova Fatura" para criar.</div>
        </div>
      </section>

      <aside>
        <div class="card" id="formCard">
          <h3 style="margin:0 0 6px 0">Nova / Editar Fatura</h3>
          <div class="muted small">Preencha os campos e clique em Salvar</div>
          <form id="invoiceForm" style="margin-top:10px">
            <input type="hidden" id="invoiceId">
            <label>Cliente <input id="cliente" required></label>
            <label>Data <input id="data" type="date"></label>
            <label>Descrição <textarea id="descricao" rows="2"></textarea></label>
            <label>Valor (R$) <input id="valor" type="number" step="0.01" min="0" value="0"></label>
            <label>Status
              <select id="status">
                <option value="Aberto">Aberto</option>
                <option value="Pago">Pago</option>
                <option value="Vencido">Vencido</option>
              </select>
            </label>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
              <button type="submit">Salvar</button>
              <button type="button" id="btnPreview" class="ghost">Visualizar Impressão</button>
            </div>
          </form>
        </div>

        <div class="card" style="margin-top:18px">
          <h4 style="margin:0">Pré-visualização rápida</h4>
          <div class="muted small">Selecione uma fatura para ver aqui</div>
          <div id="quickPreview" class="invoice-preview" style="margin-top:10px">
            <div class="muted">Nenhuma fatura selecionada</div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Invoice printable template (hidden until preview) -->
    <div id="invoicePrintArea" style="display:none;margin-top:20px" class="card invoice-print">
      <!-- content injected by JS when user requests print/preview -->
    </div>
  </main>

  <script>
    // Utilitários simples
    const $ = sel => document.querySelector(sel)
    const $$ = sel => Array.from(document.querySelectorAll(sel))

    const KEY = 'faturas_static_v1'
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY) || '[]') }catch(e){return []} }
    function save(data){ localStorage.setItem(KEY, JSON.stringify(data)) }

    // Inicialização com dados de exemplo
    if(!localStorage.getItem(KEY)){
      const sample = [
        {id: genId(), cliente:'ACME Ltda', data:'2025-11-01', descricao:'Serviços de consultoria', valor:1200.00, status:'Pago'},
        {id: genId(), cliente:'João Silva', data:'2025-11-15', descricao:'Venda de produto X', valor:450.50, status:'Aberto'}
      ]
      save(sample)
    }

    function genId(){ return 'f-'+Math.random().toString(36).slice(2,9) }

    // DOM refs
    const invoicesBody = $('#invoicesBody')
    const noData = $('#noData')
    const invoiceForm = $('#invoiceForm')
    const clienteIn = $('#cliente')
    const dataIn = $('#data')
    const descricaoIn = $('#descricao')
    const valorIn = $('#valor')
    const statusIn = $('#status')
    const invoiceIdIn = $('#invoiceId')
    const quickPreview = $('#quickPreview')
    const invoicePrintArea = $('#invoicePrintArea')

    function renderList(){
      const list = load()
      invoicesBody.innerHTML = ''
      if(list.length === 0){ noData.style.display='block'; return }
      noData.style.display='none'
      list.slice().reverse().forEach((inv, idx)=>{
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td>${inv.id}</td>
          <td><strong>${escapeHtml(inv.cliente)}</strong></td>
          <td>${inv.data || '-'}</td>
          <td>R$ ${Number(inv.valor||0).toFixed(2)}</td>
          <td>${inv.status}</td>
          <td class="right">
            <button data-id="${inv.id}" class="btnEdit ghost">Editar</button>
            <button data-id="${inv.id}" class="btnDel ghost">Excluir</button>
          </td>
        `
        invoicesBody.appendChild(tr)
      })
      attachTableActions()
    }

    function attachTableActions(){
      $$('.btnEdit').forEach(b => b.onclick = e => editInvoice(e.target.dataset.id))
      $$('.btnDel').forEach(b => b.onclick = e => deleteInvoice(e.target.dataset.id))
      $$('#invoicesBody tr').forEach(row => row.onclick = e => {
        const btn = e.target.closest('button')
        if(btn) return
        const id = row.querySelector('td').innerText
        viewQuick(id)
      })
    }

    function editInvoice(id){
      const list = load()
      const inv = list.find(i => i.id === id)
      if(!inv) return alert('Fatura não encontrada')
      invoiceIdIn.value = inv.id
      clienteIn.value = inv.cliente
      dataIn.value = inv.data
      descricaoIn.value = inv.descricao
      valorIn.value = inv.valor
      statusIn.value = inv.status
      window.scrollTo({top:0,behavior:'smooth'})
    }

    function deleteInvoice(id){
      if(!confirm('Excluir fatura?')) return
      let list = load()
      list = list.filter(i => i.id !== id)
      save(list)
      renderList()
      quickPreview.innerHTML = '<div class="muted">Nenhuma fatura selecionada</div>'
    }

    invoiceForm.addEventListener('submit', e =>{
      e.preventDefault()
      const id = invoiceIdIn.value || genId()
      const obj = {id, cliente:clienteIn.value.trim()||'Sem nome', data:dataIn.value, descricao:descricaoIn.value, valor:parseFloat(valorIn.value)||0, status:statusIn.value}
      let list = load()
      const found = list.find(i=>i.id===id)
      if(found){ list = list.map(i=> i.id===id?obj:i) } else { list.push(obj) }
      save(list)
      invoiceForm.reset(); invoiceIdIn.value=''
      renderList()
    })

    function viewQuick(id){
      const list = load(); const inv = list.find(i=>i.id===id)
      if(!inv) return
      quickPreview.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong>${escapeHtml(inv.cliente)}</strong>
            <div class="muted small">${inv.descricao||''}</div>
          </div>
          <div style="text-align:right">
            <div class="muted small">Data: ${inv.data||'-'}</div>
            <div style="font-weight:700;font-size:18px">R$ ${Number(inv.valor||0).toFixed(2)}</div>
            <div class="muted small">Status: ${inv.status}</div>
          </div>
        </div>
      `
    }

    // Preview / Print
    $('#btnPreview').onclick = () => {
      const id = invoiceIdIn.value
      if(!id) return alert('Salve a fatura primeiro ou preencha o ID.')
      const inv = load().find(i=>i.id===id)
      if(!inv) return alert('Fatura não encontrada')
      showPrintable(inv)
    }

    function showPrintable(inv){
      invoicePrintArea.style.display='block'
      invoicePrintArea.innerHTML = makePrintable(inv)
      window.print()
    }

    // New
    $('#btnNew').onclick = ()=>{ invoiceForm.reset(); invoiceIdIn.value=''; clienteIn.focus() }

    // Export CSV
    $('#btnExport').onclick = ()=>{
      const list = load()
      if(!list.length) return alert('Nenhuma fatura para exportar')
      const headers = ['id','cliente','data','descricao','valor','status']
      const rows = [headers.join(',')].concat(list.map(r => headers.map(h=> '"'+String(r[h]||'').replace(/"/g,'""')+'"').join(',')))
      const blob = new Blob([rows.join('\n')], {type:'text/csv'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a'); a.href=url; a.download='faturas.csv'; a.click(); URL.revokeObjectURL(url)
    }

    // Clear
    $('#btnClear').onclick = ()=>{ if(confirm('Remover todas as faturas?')){ localStorage.removeItem(KEY); renderList(); quickPreview.innerHTML='<div class="muted">Nenhuma fatura selecionada</div>' }}

    // Helpers
    function makePrintable(inv){
      return `
        <div style="padding:18px;background:#fff;color:#000;border-radius:8px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
            <div>
              <h2 style="margin:0">${escapeHtml(inv.cliente)}</h2>
              <div style="font-size:13px;color:#444">${escapeHtml(inv.descricao||'')}</div>
            </div>
            <div style="text-align:right">
              <div style="font-size:13px;color:#444">Data: ${inv.data||'-'}</div>
              <div style="font-weight:700;font-size:20px;margin-top:6px">R$ ${Number(inv.valor||0).toFixed(2)}</div>
              <div style="font-size:13px;color:#444">Status: ${inv.status}</div>
            </div>
          </div>
          <div style="border-top:1px solid #eee;padding-top:12px;font-size:13px;color:#222">Observações: ${escapeHtml(inv.descricao||'Sem observações')}</div>
        </div>
      `
    }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

    // Inicial render
    renderList()

    // small UX: abrir ao clicar em linha
    invoicesBody.addEventListener('click', e => {
      // prevent selecting row triggers if clicked button
    })

  </script>
</body>
</html>
